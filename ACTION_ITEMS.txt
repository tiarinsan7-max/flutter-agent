╔════════════════════════════════════════════════════════════════════════════╗
║                         BUILD ERROR - ACTION ITEMS                          ║
║                   Status: Keystore & Secrets Ready, Build Failing           ║
╚════════════════════════════════════════════════════════════════════════════╝

IMMEDIATE ACTIONS (DO THESE NOW):
─────────────────────────────────

ACTION 1: Get Exact Error Message from GitHub
────────────────────────────────────────────
1. Go to: https://github.com/tiarinsan7-max/flutter-agent/actions
2. Click: Build APK (latest failed run)
3. Scroll to: "Build release APK" step
4. Copy the FULL ERROR MESSAGE (from "Run flutter build apk..." step)
5. Paste here in next message

WHY: The specific error message will tell us exactly what's wrong

═══════════════════════════════════════════════════════════════════════════════

ACTION 2: Verify Keystore Password in GitHub Secrets
──────────────────────────────────────────────────────
1. Open Terminal
2. Run: ./GET_KEYSTORE_INFO.sh
3. Enter your keystore password when prompted
4. Note the password you entered
5. Go to: GitHub → Settings → Secrets → KEY_STORE_PASSWORD
6. Check if the value matches
7. If different, UPDATE the secret with correct password

WHY: Wrong password causes immediate signing failure

═══════════════════════════════════════════════════════════════════════════════

ACTION 3: Run Debug Workflow
──────────────────────────────
1. Go to: GitHub Actions tab
2. Select: "Debug Build" workflow (newly created)
3. Click: "Run workflow"
4. Select: debug_level = "detailed"
5. Click: "Run workflow"
6. Wait for completion (5 mins)
7. Review logs - will show exactly what's failing

WHY: Debug workflow tests each step separately, easier to spot issue

═══════════════════════════════════════════════════════════════════════════════

ACTION 4: If Still Failing - Try Simplified Config
─────────────────────────────────────────────────────
1. Edit: android/app/build.gradle.kts
2. Find: buildTypes { release { ... } }
3. Change to:
   
   buildTypes {
       release {
           signingConfig = signingConfigs.getByName("release")
           isMinifyEnabled = false      // ← Disable minification
           isShrinkResources = false    // ← Disable shrinking
       }
   }

4. Remove lines: proguardFiles(...)
5. Commit: git add . && git commit -m "simplify: disable minification"
6. Push: git push origin main
7. Test build again

WHY: Minification sometimes causes issues, easier to test without it first

═══════════════════════════════════════════════════════════════════════════════

FILES CREATED TO HELP TROUBLESHOOT:
───────────────────────────────────

1. DIAGNOSE_BUILD_ERROR.md
   ├─ Detailed troubleshooting guide
   ├─ Common errors & solutions
   ├─ Step-by-step verification
   └─ Use when you see specific error

2. .github/workflows/debug-build.yml
   ├─ Special debug workflow
   ├─ Tests each step individually
   ├─ Shows which step fails
   └─ Manually triggered via GitHub Actions

3. GET_KEYSTORE_INFO.sh
   ├─ Shows keystore information
   ├─ Verifies password works
   └─ Tells you what to put in GitHub Secrets

4. FIX_BUILD_APK.md (from before)
   ├─ Initial fix guide
   └─ Reference for setup

═══════════════════════════════════════════════════════════════════════════════

FILES ALREADY MODIFIED:
───────────────────────

✓ android/app/build.gradle.kts
  └─ Updated signing config (with null-safe getenv)
  └─ Changed from empty string defaults to null
  
✓ .github/workflows/build-apk.yml
  └─ Fixed signing step order (now before build)
  └─ Added env vars to all build steps
  
✓ android/app/proguard-rules.pro (NEW)
  └─ ProGuard minification rules

═══════════════════════════════════════════════════════════════════════════════

VERIFICATION CHECKLIST:
──────────────────────

Before saying "build still failing", verify:

□ All 4 secrets exist in GitHub:
  - ANDROID_KEYSTORE_BASE64
  - KEY_STORE_PASSWORD
  - KEY_PASSWORD
  - ALIAS_USERNAME

□ None of the secrets are empty (check each one)

□ KEY_STORE_PASSWORD matches actual keystore password
  (Run: ./GET_KEYSTORE_INFO.sh to verify)

□ ANDROID_KEYSTORE_BASE64 is full content, not a file path

□ android/app/upload-keystore.jks exists locally:
  ls -lh android/app/upload-keystore.jks

□ android/app/proguard-rules.pro exists:
  ls -lh android/app/proguard-rules.pro

□ android/app/build.gradle.kts is committed:
  git status (should be clean)

□ Latest changes are pushed:
  git log -1

═══════════════════════════════════════════════════════════════════════════════

WHAT TO DO NEXT:
────────────────

1. FIRST: Do ACTION 1 above (get exact error)
2. THEN: Share error message
3. I will provide specific fix based on error

OR

1. Try ACTION 2 (verify password)
2. Try ACTION 3 (run debug workflow)
3. Share logs from debug workflow
4. I will identify exact issue

═══════════════════════════════════════════════════════════════════════════════

EXPECTED TIMELINE:
──────────────────

✓ Actions 1-3: 10 minutes
✓ Debug workflow run: 5-10 minutes
✓ Identify issue: 2 minutes
✓ Fix: 5-15 minutes (depends on issue)

Total: ~30 minutes to working build

═══════════════════════════════════════════════════════════════════════════════

POSSIBLE ROOT CAUSES (Most Common):
──────────────────────────────────

1. 60% - Wrong password in KEY_STORE_PASSWORD secret
2. 20% - Corrupted base64 in ANDROID_KEYSTORE_BASE64
3. 10% - Empty secrets (typo or not saved properly)
4. 5% - Gradle/Java version incompatibility
5. 5% - Network/CI environment issue

═══════════════════════════════════════════════════════════════════════════════

IMPORTANT REMINDERS:
───────────────────

⚠️  NEVER commit upload-keystore.jks to git
⚠️  NEVER hardcode passwords in code
⚠️  Keep keystore-base64.txt private
⚠️  GitHub Secrets are encrypted, safe to use
⚠️  Don't share ANDROID_KEYSTORE_BASE64 content

═══════════════════════════════════════════════════════════════════════════════

Ready to help! Please start with ACTION 1 above.
